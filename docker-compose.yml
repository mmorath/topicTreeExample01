# WARNING: Do not deploy this configuration directly to a production environment
#
# The tutorial docker-compose files have not been written for production deployment and will not 
# scale. A proper architecture has been sacrificed to keep the narrative focused on the learning 
# goals, they are just used to deploy everything onto a single Docker machine. 
# They also contain various obvious security flaws - passwords in plain text, no load balancing,
# no use of HTTPS and so on. 
# 
# This is all to avoid the need of multiple machines, generating certificates, encrypting secrets
# and so on, purely so that a single docker-compose file can be read as an example to build on, 
# not use directly. 

# url: 2fec63f5313749619e6cadcd3272d557.s2.eu.hivemq.cloud  port:8883
# publisher: username: mqtt_publisher-01    pw:eQZ~Mcb265Em:n,
# subscriber: username: mqtt_subscriber-01  pw:K^eY}qV9q@Vv6KQ
# mqtt-explorer: username: mqtt_explorer    pw:8kliIkn-owlkm-ow

version: "3.0"

services:

    pup_sub_airpressure:
        build: ./mqttPub
        hostname: pup_sub_airpressure
        container_name: pup_sub_airpressure
        #restart: always
        volumes:
          - ./mqttPub/data/conf_airpressure.json:/app/data/conf.json
        networks:
          - mqtt_network
        logging:
          options:
            max-size: "10m"
            max-file: "3"

    pup_sub_cooling:
        build: ./mqttPub
        hostname: pup_sub_cooling
        container_name: pup_sub_cooling
        #restart: always
        volumes:
          - ./mqttPub/data/conf_cooling.json:/app/data/conf.json
        networks:
          - mqtt_network
        logging:
          options:
            max-size: "10m"
            max-file: "3"

    pup_sub_exhaust:
        build: ./mqttPub
        hostname: pup_sub_exhaust
        container_name: pup_sub_exhaust
        #restart: always
        volumes:
          - ./mqttPub/data/conf_exhaust.json:/app/data/conf.json
        networks:
          - mqtt_network
        logging:
          options:
            max-size: "10m"
            max-file: "3"

    pup_sub_fit:
        build: ./mqttPub
        hostname: pup_sub_fit
        container_name: pup_sub_fit
        #restart: always
        volumes:
          - ./mqttPub/data/conf_exhaust.json:/app/data/conf.json
        networks:
          - mqtt_network
        logging:
          options:
            max-size: "10m"
            max-file: "3"

    pup_sub_exhaust:
        build: ./mqttPub
        hostname: pup_sub_exhaust
        container_name: pup_sub_exhaust
        #restart: always
        volumes:
          - ./mqttPub/data/conf_exhaust.json:/app/data/conf.json
        networks:
          - mqtt_network
        logging:
          options:
            max-size: "10m"
            max-file: "3"

    pup_sub_exhaust:
        build: ./mqttPub
        hostname: pup_sub_exhaust
        container_name: pup_sub_exhaust
        #restart: always
        volumes:
          - ./mqttPub/data/conf_exhaust.json:/app/data/conf.json
        networks:
          - mqtt_network
        logging:
          options:
            max-size: "10m"
            max-file: "3"

    pup_sub_exhaust:
        build: ./mqttPub
        hostname: pup_sub_exhaust
        container_name: pup_sub_exhaust
        #restart: always
        volumes:
          - ./mqttPub/data/conf_exhaust.json:/app/data/conf.json
        networks:
          - mqtt_network
        logging:
          options:
            max-size: "10m"
            max-file: "3"

    pup_sub_exhaust:
        build: ./mqttPub
        hostname: pup_sub_exhaust
        container_name: pup_sub_exhaust
        #restart: always
        volumes:
          - ./mqttPub/data/conf_exhaust.json:/app/data/conf.json
        networks:
          - mqtt_network
        logging:
          options:
            max-size: "10m"
            max-file: "3"

    pup_sub_exhaust:
        build: ./mqttPub
        hostname: pup_sub_exhaust
        container_name: pup_sub_exhaust
        #restart: always
        volumes:
          - ./mqttPub/data/conf_exhaust.json:/app/data/conf.json
        networks:
          - mqtt_network
        logging:
          options:
            max-size: "10m"
            max-file: "3"

networks:
  mqtt_network:
    driver: bridge